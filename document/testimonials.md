# Testimonials API ðŸ“£

**Base URL:** `/api/testimonials`

---

## Overview
User-submitted testimonials for events (with optional image). Public endpoints allow listing and fetching testimonials; protected endpoints (employee auth) allow creating, updating, and deleting.

---

## Authentication
- **Protected endpoints** require **Bearer** token authentication from an employee account (see `document/employee.md`).

---

## Fields (full)
- **id** (int) â€” autogenerated
- **name** (string) â€” *required for create*
 **city_id** (int) â€” optional, refers to `cities.id`
 **city_name** (string) â€” always included, name of the city (if city_id is set)
 **event_id** (int) â€” optional, refers to `events.id`
 **event_name** (string) â€” always included, name of the event (if event_id is set)
 **rating** (int) â€” 1 to 5
 **testimonial** (text) â€” optional
 **submitted_at** (date) â€” defaults to current date if omitted
 **status** (enum) â€” `Published`, `Pending`, `Rejected` (default: `Pending`)
 **image_url** (string) â€” optional URL to image
 **priority** (int) â€” sorting priority (higher first)
 **is_active** (tinyint) â€” 1 (true) or 0 (false)
 **created_at**, **updated_at** (timestamps)

---

## Full Payload Examples

### Create (full payload)
Use this payload when creating a testimonial (all fields shown). Omit fields you do not have â€” DB defaults will be applied where configured.

Request body (JSON):

```
{
  "name": "Sahana Kumar",
  "city_id": 3,
  "event_id": 12,
  "rating": 5,
  "testimonial": "Amazing event â€” the kids had a blast!",
  "submitted_at": "2025-12-20",
  "status": "Published",
  "image_url": "https://cdn.example.com/uploads/testimonial-12.jpg",
  "priority": 10,
  "is_active": 1
}
```

### Update (full payload)
Partial updates are supported; include only fields you want to change.

Request body (JSON):

```
{
  "name": "Sahana K.",
  "rating": 4,
  "status": "Published",
  "priority": 5
}
```

---

## Full Responses (examples)

### Create â€” 201 Created
```
HTTP/1.1 201 Created
Content-Type: application/json

{
  "success": true,
  "message": "Testimonial created",
  "id": 123,
  "data": {
    "id": 123,
    "name": "Sahana Kumar",
    "city_id": 3,
    "event_id": 12,
    "rating": 5,
    "testimonial": "Amazing event â€” the kids had a blast!",
    "submitted_at": "2025-12-20",
    "status": "Published",
    "image_url": "https://cdn.example.com/uploads/testimonial-12.jpg",
    "priority": 10,
    "is_active": 1,
    "created_at": "2025-12-20T06:30:00.000Z",
    "updated_at": "2025-12-20T06:30:00.000Z"
  }
}
```

### Get Single â€” 200 OK
```
HTTP/1.1 200 OK
Content-Type: application/json

{
  "success": true,
  "data": {
    "id": 123,
    "name": "Sahana Kumar",
    "city_id": 3,
    "event_id": 12,
    "rating": 5,
    "testimonial": "Amazing event â€” the kids had a blast!",
    "submitted_at": "2025-12-20",
    "status": "Published",
    "image_url": "https://cdn.example.com/uploads/testimonial-12.jpg",
    "priority": 10,
    "is_active": 1,
    "created_at": "2025-12-20T06:30:00.000Z",
    "updated_at": "2025-12-20T06:30:00.000Z"
  }
}
```

### List (paginated) â€” 200 OK
```
HTTP/1.1 200 OK
Content-Type: application/json

{
  "success": true,
  "data": [
    {
      "id": 123,
      "name": "Sahana Kumar",
      "city_id": 3,
      "city_name": "Bangalore",
      "event_id": 12,
      "event_name": "Winter Carnival 2025",
      "rating": 5,
      "testimonial": "Amazing event â€” the kids had a blast!",
      "submitted_at": "2025-12-20",
      "status": "Published",
      "image_url": "https://cdn.example.com/uploads/testimonial-12.jpg",
      "priority": 10,
      "is_active": 1,
      "created_at": "2025-12-20T06:30:00.000Z",
      "updated_at": "2025-12-20T06:30:00.000Z"
    },
    {
      "id": 124,
      "name": "Ravi Patel",
      "city_id": 2,
      "city_name": "Chennai",
      "city_id": 3,
      "city_name": "Bangalore",
      "event_id": 12,
      "event_name": "Winter Carnival 2025",
      "event_name": "Summer Fest 2025",
      "rating": 4,
      "testimonial": "Good, but could be better organized.",
      "submitted_at": "2025-12-19",
      "status": "Published",
      "image_url": null,
      "priority": 5,
      "is_active": 1,
      "created_at": "2025-12-19T10:00:00.000Z",
      "updated_at": "2025-12-19T10:00:00.000Z"
    }
  ],
  "meta": {
    "limit": 20,
    "offset": 0,
    "data": {
      "id": 123,
      "name": "Sahana Kumar",
      "city_id": 3,
      "city_name": "Bangalore",
      "city_id": 2,
      "city_name": "Chennai",
      "event_id": 15,
      "event_name": "Summer Fest 2025",
      "event_name": "Winter Carnival 2025",
      "rating": 5,
      "testimonial": "Amazing event â€” the kids had a blast!",
      "submitted_at": "2025-12-20",
      "status": "Published",
      "image_url": "https://cdn.example.com/uploads/testimonial-12.jpg",
      "priority": 10,
      "is_active": 1,
      "created_at": "2025-12-20T06:30:00.000Z",
      "updated_at": "2025-12-20T06:30:00.000Z"
    }
HTTP/1.1 200 OK
Content-Type: application/json

{ "success": true, "message": "Testimonial deleted" }
```

---

## Error responses (examples)

- **400 Bad Request** â€” validation error

```
HTTP/1.1 400 Bad Request
Content-Type: application/json

{ "success": false, "message": "rating must be between 1 and 5" }
```

- **401 Unauthorized** â€” missing/invalid token for protected endpoints

```
HTTP/1.1 401 Unauthorized
Content-Type: application/json

{ "success": false, "message": "Unauthorized" }
```

- **404 Not Found** â€” resource not found

```
HTTP/1.1 404 Not Found
Content-Type: application/json

{ "success": false, "message": "Testimonial not found" }
```

- **500 Internal Server Error**

```
HTTP/1.1 500 Internal Server Error
Content-Type: application/json

{ "success": false, "message": "Database error" }
```

---

## cURL examples (full)

Create (JSON):
```
curl -X POST http://localhost:3004/api/testimonials \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Sahana Kumar",
    "city_id": 3,
    "city_id": 3,
    "city_name": "Bangalore",
    "event_id": 12,
    "event_name": "Winter Carnival 2025",
    "rating": 5,
    "testimonial": "Amazing event",
    "image_url": "https://cdn.example.com/x.jpg",
    "priority": 10
  }'
```

Create (multipart upload with image):
```
curl -X POST http://localhost:3004/api/testimonials \
  -H "Authorization: Bearer {token}" \
  -F "name=Sahana Kumar" \
  -F "rating=5" \
  -F "testimonial=Amazing event" \
  -F "image_file=@./photo.jpg" \
  -F "event_id=12"
```

> Note: The API currently accepts `image_url` directly. If you want multipart upload handling (storing uploaded file and returning `image_url`), we can add an upload handler endpoint.

---

## Related
- Events: `/api/events` (testimonials can reference events)
- Cities: `/api/city`
- Auth details: `document/employee.md`

---

If you'd like, I can now apply the same full-payload + full-response template to `event.md` and `booking.md`, or generate a consolidated API index linking all docs.

