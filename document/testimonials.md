# Testimonials API ðŸ“£

**Base URL:** http://localhost:3004/api/testimonials

---

## Overview
User-submitted testimonials for events (optional image). Public endpoints allow listing and fetching testimonials; protected endpoints (employee auth) allow creating, updating, and deleting testimonials.

---
## Authentication
- **Protected endpoints** require **Bearer** token authentication from an employee account (see `document/employee.md`).

---

## Fields (full)
- **id** (int) â€” autogenerated
- **name** (string) â€” **required** when creating
- **city_id** (int) â€” optional, refers to `cities.id`
- **city_name** (string) â€” included when `city_id` is present
- **event_id** (int) â€” optional, refers to `events.id`
- **event_name** (string) â€” included when `event_id` is present (GET/list responses include `event_name` and `city_name` when available)
- **rating** (int) â€” 1 to 5
- **testimonial** (text)
- **submitted_at** (date) â€” defaults to current date if omitted
- **status** (enum) â€” `Published`, `Pending`, `Rejected` (default: `Pending`)
- **image_url** (string) â€” optional URL to image
- **priority** (int) â€” sorting priority (higher first)
- **is_active** (tinyint) â€” 1 (true) or 0 (false)
- **created_at**, **updated_at** (timestamps)

---

## Full Payload Examples

### Create (JSON)
```
POST http://localhost:3004/api/testimonials
Headers: Authorization: Bearer {token}
Content-Type: application/json

{
  "name": "Sahana Kumar",
  "city_id": 3,
  "event_id": 12,
  "rating": 5,
  "testimonial": "Amazing event â€” the kids had a blast!",
  "submitted_at": "2025-12-20",
  "status": "Published",
  "image_url": "https://cdn.example.com/uploads/testimonial-12.jpg",
  "priority": 10,
  "is_active": 1
}
```

### Create (multipart file upload)
```
POST http://localhost:3004/api/testimonials
Headers: Authorization: Bearer {token}
Content-Type: multipart/form-data

- name: Sahana Kumar
- rating: 5
- testimonial: "Amazing event"
- image_file: @./photo.jpg
- event_id: 12
```

> Note: The current implementation accepts `image_url` directly. Use multipart only if your server supports file uploads â€” I can add upload handler code if you want automatic file storage and `image_url` generation.

### Update (partial)
```
PUT http://localhost:3004/api/testimonials/123
Headers: Authorization: Bearer {token}
Content-Type: application/json

{ "rating": 4, "status": "Published" }
```

---

## Full Responses (examples)

### Create â€” 201 Created
```
HTTP/1.1 201 Created
Content-Type: application/json

{
  "success": true,
  "message": "Testimonial created",
  "id": 123
}
```

### Get Single â€” 200 OK
```
HTTP/1.1 200 OK
Content-Type: application/json

{ "success": true, "data": { /* full testimonial object */ } }
```

### List â€” 200 OK
```
HTTP/1.1 200 OK
Content-Type: application/json

{
  "success": true,
  "data": [
    {
      "id": 123,
      "name": "Sahana Kumar",
      "city_id": 3,
      "city_name": "Bangalore",
      "event_id": 12,
      "event_name": "Winter Carnival 2025",
      "rating": 5,
      "testimonial": "Amazing event â€” the kids had a blast!",
      "submitted_at": "2025-12-20",
      "status": "Published",
      "image_url": "https://cdn.example.com/uploads/testimonial-12.jpg",
      "priority": 10,
      "is_active": 1,
      "created_at": "2025-12-20T06:30:00.000Z",
      "updated_at": "2025-12-20T06:30:00.000Z"
    }
  ]
}
```

> Supported query parameters: `event_id`, `city_id`, `status` (the current implementation returns the filtered array; pagination is not implemented by default).

### Update â€” 200 OK
```
{ "success": true, "message": "Testimonial updated", "data": { /* updated object */ } }
```

### Delete â€” 200 OK
```
{ "success": true, "message": "Testimonial deleted" }
```



## Client Examples
JavaScript (fetch):
```javascript
async function listTestimonials() {
  const res = await fetch('http://localhost:3004/api/testimonials?limit=10');
  return res.json();
}
```

Node (axios):
```javascript
const axios = require('axios');
axios.get('http://localhost:3004/api/testimonials?status=Published').then(r => console.log(r.data));
```

If you'd like, I can also apply this full-payload + full-response template to `event.md` and `booking.md`, or generate a consolidated API index linking all docs.
---

## Error responses (examples)

- **400 Bad Request** â€” validation error

```
HTTP/1.1 400 Bad Request
Content-Type: application/json

{ "success": false, "message": "rating must be between 1 and 5" }
```

- **401 Unauthorized** â€” missing/invalid token for protected endpoints

```
HTTP/1.1 401 Unauthorized
Content-Type: application/json

{ "success": false, "message": "Unauthorized" }
```

- **404 Not Found** â€” resource not found

```
HTTP/1.1 404 Not Found
Content-Type: application/json

{ "success": false, "message": "Testimonial not found" }
```

- **500 Internal Server Error**

```
HTTP/1.1 500 Internal Server Error
Content-Type: application/json

{ "success": false, "message": "Database error" }
```

---

## cURL examples

List (filter by status/event/city):
```
curl -X GET "http://localhost:3004/api/testimonials?status=Published&event_id=12&city_id=3"
```

Get single testimonial:
```
curl -X GET "http://localhost:3004/api/testimonials/123"
```

Create (JSON):
```
curl -X POST "http://localhost:3004/api/testimonials" \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Sahana Kumar",
    "city_id": 3,
    "event_id": 12,
    "rating": 5,
    "testimonial": "Amazing event",
    "image_url": "https://cdn.example.com/x.jpg",
    "priority": 10
  }'
```

Create (multipart â€” only if upload handler present):
```
curl -X POST "http://localhost:3004/api/testimonials" \
  -H "Authorization: Bearer {token}" \
  -F "name=Sahana Kumar" \
  -F "rating=5" \
  -F "testimonial=Amazing event" \
  -F "image_file=@./photo.jpg" \
  -F "event_id=12"
```

Update (JSON):
```
curl -X PUT "http://localhost:3004/api/testimonials/123" \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{"rating":4}'
```

Delete:
```
curl -X DELETE "http://localhost:3004/api/testimonials/123" \
  -H "Authorization: Bearer {token}"
```

> Tip: the current API stores `image_url` directly; if you want automatic file uploads that return `image_url`, I can implement an upload endpoint and update docs accordingly.

---

## Related
- Events: `/api/events` (testimonials can reference events)
- Cities: `/api/city`
- Auth details: `document/employee.md`

---
